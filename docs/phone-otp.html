<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Continue</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin:0; background:#f6f7f9; }
    .wrap { max-width: 440px; margin: 6vh auto; padding: 0 16px; }
    .card { background:#fff; border:1px solid rgba(0,0,0,.06); border-radius:16px; box-shadow:0 4px 18px rgba(0,0,0,.05); padding:24px; }
    h1 { font-size:1.25rem; margin:0 0 8px; text-align:center; }
    .hint { color:#555; font-size:.95rem; margin:0 0 16px; text-align:center; }
    #api { margin-top: 8px; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1 id="title">Continue</h1>
      <div id="subtitle" class="hint">Enter your phone to receive a code.</div>
      <div id="api"></div>
    </div>
  </div>

  <script>
    // --- 1) Favorites (order matters) ---
    // Put your ISO country codes here.
    const FAVORITES = ["US","GB","CA","AU","FR","NZ","IE","SG","ZA"];

    // --- 2) Simple i18n (EN/FR) for the page chrome only ---
    function getLocale() {
      const qp = new URLSearchParams(window.location.search);
      const ui = (qp.get("ui_locales") || navigator.language || "en").toLowerCase();
      return ui.startsWith("fr") ? "fr" : "en";
    }
    function setTexts() {
      const t = { 
        en: { title: "Continue", sub: "Enter your phone to receive a code." },
        fr: { title: "Continuer", sub: "Saisissez votre numéro de téléphone pour recevoir un code." }
      }[getLocale()];
      document.getElementById("title").textContent = t.title;
      document.getElementById("subtitle").textContent = t.sub;
    }
    setTexts();

    // --- 3) Pin favorite countries while keeping the rest ---
    function findCountrySelect() {
      // B2C uses a phone control with a country <select>. Try common selectors.
      const sels = [
        'select#country',
        'select[name*="country"]',
        'select[id*="country"]',
        '.phoneControl select',
        'select[aria-label*="Country"]',
        'select[aria-label*="Pays"]',
        'select'
      ];
      for (const s of sels) {
        const el = document.querySelector(s);
        if (el && el.tagName === "SELECT" && el.options?.length > 0) return el;
      }
      return null;
    }

    function pinFavorites(selectEl) {
      if (!selectEl) return;

      // Preserve current selection
      const current = selectEl.value;

      // Map options by value (B2C uses ISO codes as values in the country list)
      const all = Array.from(selectEl.options);
      const map = new Map(all.map(o => [String(o.value).toUpperCase(), o]));

      const favs = [];
      const rest = [];

      FAVORITES.forEach(code => {
        const opt = map.get(code.toUpperCase());
        if (opt) favs.push(opt);
      });

      all.forEach(o => {
        const code = String(o.value).toUpperCase();
        if (!FAVORITES.includes(code)) rest.push(o);
      });

      // Rebuild dropdown: favorites first, then the rest (original order preserved)
      selectEl.innerHTML = "";
      [...favs, ...rest].forEach(o => selectEl.appendChild(o));

      // Restore selection if any
      if (current) selectEl.value = current;
    }

    // React to B2C injecting content
    const api = document.getElementById("api");
    const obs = new MutationObserver(() => {
      const sel = findCountrySelect();
      if (sel) {
        pinFavorites(sel);
        // Re-pin if options change dynamically
        sel.addEventListener("DOMNodeInserted", () => pinFavorites(sel));
      }
    });
    obs.observe(api, { childList: true, subtree: true });

    // Optional: re-pin on language change (B2C can re-render)
    window.addEventListener("hashchange", () => {
      const sel = findCountrySelect();
      if (sel) pinFavorites(sel);
    });
  </script>
</body>
</html>
